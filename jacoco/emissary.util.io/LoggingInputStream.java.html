<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LoggingInputStream.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Emissary</a> &gt; <a href="index.source.html" class="el_package">emissary.util.io</a> &gt; <span class="el_source">LoggingInputStream.java</span></div><h1>LoggingInputStream.java</h1><pre class="source lang-java linenums">package emissary.util.io;

import org.slf4j.Logger;

import java.io.IOException;
import java.io.InputStream;
import java.util.Arrays;

/**
 * This InputStream wraps another InputStream and logs all methods calls.
 */
public class LoggingInputStream extends InputStream {
    /**
     * The InputStream that is being wrapped.
     */
    private final InputStream inputStream;
    /**
     * The prefix added to the log statement.
     */
    private final String prefix;
    /**
     * The logger to be used for logging.
     */
    private final Logger logger;
    /**
     * Determines whether a stack trace should also be logged.
     */
    private final boolean logStackTrace;

    /**
     * Constructs a InputStream that wraps another InputStream and logs all methods calls.
     * 
     * @param inputStream to be wrapped.
     * @param prefix added to the log statement.
     * @param logger to be used for logging.
     * @param logStackTrace determines whether a stack trace should also be logged.
     */
    public LoggingInputStream(final InputStream inputStream, final String prefix, final Logger logger,
<span class="fc" id="L39">            final boolean logStackTrace) {</span>
<span class="fc" id="L40">        this.inputStream = inputStream;</span>
<span class="fc" id="L41">        this.prefix = prefix;</span>
<span class="fc" id="L42">        this.logger = logger;</span>
<span class="fc" id="L43">        this.logStackTrace = logStackTrace;</span>

<span class="fc" id="L45">        log(&quot;{} : created : lST={}&quot;, prefix, logStackTrace);</span>
<span class="fc" id="L46">    }</span>

    @Override
    public int read() throws IOException {
<span class="fc" id="L50">        final int r = inputStream.read();</span>

<span class="fc" id="L52">        log(&quot;{} : read-0 : r={}&quot;, prefix, r);</span>

<span class="fc" id="L54">        return r;</span>
    }

    @Override
    public int read(final byte[] b) throws IOException {
<span class="fc" id="L59">        final int r = inputStream.read(b);</span>

<span class="fc" id="L61">        log(&quot;{} : read-1 : r={}&quot;, prefix, r);</span>

<span class="fc" id="L63">        return r;</span>
    }

    @Override
    public int read(final byte[] b, final int off, final int len) throws IOException {
<span class="fc" id="L68">        final int r = inputStream.read(b, off, len);</span>

<span class="fc" id="L70">        log(&quot;{} : read-3 : off={} len={} : r={}&quot;, prefix, off, len, r);</span>

<span class="fc" id="L72">        return r;</span>
    }

    @Override
    public long skip(final long n) throws IOException {
<span class="fc" id="L77">        final long r = inputStream.skip(n);</span>

<span class="fc" id="L79">        log(&quot;{} : skip : n={} : r={}&quot;, prefix, n, r);</span>

<span class="fc" id="L81">        return r;</span>
    }

    @Override
    public int available() throws IOException {
<span class="fc" id="L86">        final int r = inputStream.available();</span>

<span class="fc" id="L88">        log(&quot;{} : available : r={}&quot;, prefix, r);</span>

<span class="fc" id="L90">        return r;</span>
    }

    @Override
    public void close() throws IOException {
<span class="fc" id="L95">        log(&quot;{} : close&quot;, prefix);</span>

<span class="fc" id="L97">        inputStream.close();</span>
<span class="fc" id="L98">    }</span>

    @Override
    public synchronized void mark(final int readlimit) {
<span class="fc" id="L102">        log(&quot;{} : mark : rl={}&quot;, prefix, readlimit);</span>

<span class="fc" id="L104">        inputStream.mark(readlimit);</span>
<span class="fc" id="L105">    }</span>

    @Override
    public synchronized void reset() throws IOException {
<span class="fc" id="L109">        log(&quot;{} : reset&quot;, prefix);</span>

<span class="fc" id="L111">        inputStream.reset();</span>
<span class="fc" id="L112">    }</span>

    @Override
    public boolean markSupported() {
<span class="fc" id="L116">        final boolean r = inputStream.markSupported();</span>

<span class="fc" id="L118">        log(&quot;{} : markSupported : r={}&quot;, prefix, r);</span>

<span class="fc" id="L120">        return r;</span>
    }

    private void log(final String format, final Object... arguments) {
<span class="fc bfc" id="L124" title="All 2 branches covered.">        if (logStackTrace) {</span>
<span class="fc" id="L125">            final Object[] newArguments = Arrays.copyOf(arguments, arguments.length + 1);</span>

            // &quot;Throwable&quot; is used since this class should only be used during development.
<span class="fc" id="L128">            newArguments[newArguments.length - 1] = new Throwable(&quot;DEBUG&quot;);</span>

<span class="fc" id="L130">            logger.info(format, newArguments);</span>
<span class="fc" id="L131">        } else {</span>
<span class="fc" id="L132">            logger.info(format, arguments);</span>
        }
<span class="fc" id="L134">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>