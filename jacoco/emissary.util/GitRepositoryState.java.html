<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GitRepositoryState.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Emissary</a> &gt; <a href="index.source.html" class="el_package">emissary.util</a> &gt; <span class="el_source">GitRepositoryState.java</span></div><h1>GitRepositoryState.java</h1><pre class="source lang-java linenums">package emissary.util;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.Properties;

/**
 * POJO for parsing and returning values from a git properties file. The properties file is created during the maven
 * build process by the git-commit-id-maven-plugin
 *
 */
public class GitRepositoryState {

<span class="fc" id="L19">    private static final Logger LOG = LoggerFactory.getLogger(GitRepositoryState.class);</span>

    private final String tags;
    private final String branch;
    private final String dirty;
    private final String remoteOriginUrl;
    private final String commitIdAbbrev;
    private final String commitId;
    private final String describe;
    private final String describeShort;
    private final String commitUserName;
    private final String commitUserEmail;
    private final String commitMessageFull;
    private final String commitMessageShort;
    private final String commitTime;
    private final String closestTagName;
    private final String closestTagCommitCount;
    private final String buildUserName;
    private final String buildUserEmail;
    private final String buildTime;
    private final String buildHost;
    private final String buildVersion;

<span class="fc" id="L42">    private GitRepositoryState(Properties properties) {</span>

<span class="fc" id="L44">        this.tags = properties.get(&quot;git.tags&quot;).toString();</span>
<span class="fc" id="L45">        this.branch = properties.get(&quot;git.branch&quot;).toString();</span>
<span class="fc" id="L46">        this.dirty = properties.get(&quot;git.dirty&quot;).toString();</span>
<span class="fc" id="L47">        this.remoteOriginUrl = properties.get(&quot;git.remote.origin.url&quot;).toString();</span>

<span class="fc" id="L49">        this.commitIdAbbrev = properties.get(&quot;git.commit.id.abbrev&quot;).toString();</span>
<span class="fc" id="L50">        this.commitId = properties.get(&quot;git.commit.id.full&quot;).toString();</span>
<span class="fc" id="L51">        this.describe = properties.get(&quot;git.commit.id.describe&quot;).toString();</span>
<span class="fc" id="L52">        this.describeShort = properties.get(&quot;git.commit.id.describe-short&quot;).toString();</span>
<span class="fc" id="L53">        this.commitUserName = properties.get(&quot;git.commit.user.name&quot;).toString();</span>
<span class="fc" id="L54">        this.commitUserEmail = properties.get(&quot;git.commit.user.email&quot;).toString();</span>
<span class="fc" id="L55">        this.commitMessageFull = properties.get(&quot;git.commit.message.full&quot;).toString();</span>
<span class="fc" id="L56">        this.commitMessageShort = properties.get(&quot;git.commit.message.short&quot;).toString();</span>
<span class="fc" id="L57">        this.commitTime = properties.get(&quot;git.commit.time&quot;).toString();</span>
<span class="fc" id="L58">        this.closestTagName = properties.get(&quot;git.closest.tag.name&quot;).toString();</span>
<span class="fc" id="L59">        this.closestTagCommitCount = properties.get(&quot;git.closest.tag.commit.count&quot;).toString();</span>

<span class="fc" id="L61">        this.buildUserName = properties.get(&quot;git.build.user.name&quot;).toString();</span>
<span class="fc" id="L62">        this.buildUserEmail = properties.get(&quot;git.build.user.email&quot;).toString();</span>
<span class="fc" id="L63">        this.buildTime = properties.get(&quot;git.build.time&quot;).toString();</span>
<span class="fc" id="L64">        this.buildHost = properties.get(&quot;git.build.host&quot;).toString();</span>
<span class="fc" id="L65">        this.buildVersion = properties.get(&quot;git.build.version&quot;).toString();</span>
<span class="fc" id="L66">    }</span>

    public static GitRepositoryState getRepositoryState() {
<span class="fc" id="L69">        return getRepositoryState(&quot;emissary.git.properties&quot;);</span>
    }

    public static GitRepositoryState getRepositoryState(String gitProperties) {
<span class="fc" id="L73">        Properties properties = new Properties();</span>
        try {
<span class="fc" id="L75">            properties.load(GitRepositoryState.class.getClassLoader().getResourceAsStream(gitProperties));</span>
<span class="nc" id="L76">        } catch (IOException ie) {</span>
<span class="nc" id="L77">            LOG.error(&quot;Failed to get repository state&quot;, ie);</span>
<span class="fc" id="L78">        }</span>
<span class="fc" id="L79">        return new GitRepositoryState(properties);</span>
    }

    public static GitRepositoryState getRepositoryState(Path gitProperties) {
<span class="fc" id="L83">        Properties properties = new Properties();</span>
<span class="fc" id="L84">        try (InputStream propertiesStream = Files.newInputStream(gitProperties)) {</span>
<span class="fc" id="L85">            properties.load(propertiesStream);</span>
<span class="nc" id="L86">        } catch (IOException ie) {</span>
<span class="nc" id="L87">            LOG.error(&quot;Failed to get repository state&quot;, ie);</span>
<span class="fc" id="L88">        }</span>
<span class="fc" id="L89">        return new GitRepositoryState(properties);</span>
    }

    public static String dumpVersionInfo(GitRepositoryState gitRepositoryState, String applicationName) {
<span class="fc" id="L93">        return String.format(&quot;%s Version: %s - built on %s - git hash: %s&quot;, applicationName, gitRepositoryState.buildVersion,</span>
<span class="fc" id="L94">                gitRepositoryState.buildTime, gitRepositoryState.getCommitIdAbbrev());</span>
    }

    public String getTags() {
<span class="nc" id="L98">        return tags;</span>
    }

    public String getBranch() {
<span class="nc" id="L102">        return branch;</span>
    }

    public String getDirty() {
<span class="nc" id="L106">        return dirty;</span>
    }

    public String getRemoteOriginUrl() {
<span class="nc" id="L110">        return remoteOriginUrl;</span>
    }

    public String getCommitIdAbbrev() {
<span class="fc" id="L114">        return commitIdAbbrev;</span>
    }

    public String getCommitId() {
<span class="nc" id="L118">        return commitId;</span>
    }

    public String getDescribe() {
<span class="nc" id="L122">        return describe;</span>
    }

    public String getDescribeShort() {
<span class="nc" id="L126">        return describeShort;</span>
    }

    public String getCommitUserName() {
<span class="nc" id="L130">        return commitUserName;</span>
    }

    public String getCommitUserEmail() {
<span class="nc" id="L134">        return commitUserEmail;</span>
    }

    public String getCommitMessageFull() {
<span class="nc" id="L138">        return commitMessageFull;</span>
    }

    public String getCommitMessageShort() {
<span class="nc" id="L142">        return commitMessageShort;</span>
    }

    public String getCommitTime() {
<span class="nc" id="L146">        return commitTime;</span>
    }

    public String getClosestTagName() {
<span class="nc" id="L150">        return closestTagName;</span>
    }

    public String getClosestTagCommitCount() {
<span class="nc" id="L154">        return closestTagCommitCount;</span>
    }

    public String getBuildUserName() {
<span class="nc" id="L158">        return buildUserName;</span>
    }

    public String getBuildUserEmail() {
<span class="nc" id="L162">        return buildUserEmail;</span>
    }

    public String getBuildTime() {
<span class="fc" id="L166">        return buildTime;</span>
    }

    public String getBuildHost() {
<span class="nc" id="L170">        return buildHost;</span>
    }

    public String getBuildVersion() {
<span class="fc" id="L174">        return buildVersion;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>